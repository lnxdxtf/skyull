<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Portable atomic types including support for 128-bit atomics, atomic float, etc."><meta name="keywords" content="rust, rustlang, rust-lang, portable_atomic"><title>portable_atomic - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-93196c7a1c3542a8.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-4743e13df3dfe8c4.css"><link rel="stylesheet" disabled href="../static.files/dark-0e1b889528bd466b.css"><link rel="stylesheet" disabled href="../static.files/ayu-65289d5d067c7c66.css"><script id="default-settings" ></script><script src="../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-3367e395607fafc1.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../portable_atomic/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../portable_atomic/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate portable_atomic</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.3.19</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">portable_atomic</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/portable_atomic/lib.rs.html#1-4432">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Portable atomic types including support for 128-bit atomics, atomic float, etc.</p>
<ul>
<li>Provide all atomic integer types (<code>Atomic{I,U}{8,16,32,64}</code>) for all targets that can use atomic CAS. (i.e., all targets that can use <code>std</code>, and most no-std targets)</li>
<li>Provide <code>AtomicI128</code> and <code>AtomicU128</code>.</li>
<li>Provide <code>AtomicF32</code> and <code>AtomicF64</code>. (<a href="#optional-features-float">optional</a>)</li>
</ul>
<!-- - Provide generic `Atomic<T>` type. (optional) -->
<ul>
<li>Provide atomic load/store for targets where atomic is not available at all in the standard library. (RISC-V without A-extension, MSP430, AVR)</li>
<li>Provide atomic CAS for targets where atomic CAS is not available in the standard library. (thumbv6m, pre-v6 ARM, RISC-V without A-extension, MSP430, AVR) (<a href="#optional-cfg">optional and single-core only</a> for ARM and RISC-V, always enabled for MSP430 and AVR)</li>
<li>Provide stable equivalents of the standard library’s atomic types’ unstable APIs, such as <a href="https://github.com/rust-lang/rust/issues/99108"><code>AtomicPtr::fetch_*</code></a>, <a href="https://github.com/rust-lang/rust/issues/98485"><code>AtomicBool::fetch_not</code></a>.</li>
<li>Make features that require newer compilers, such as <a href="https://doc.rust-lang.org/std/sync/atomic/struct.AtomicUsize.html#method.fetch_max">fetch_max</a>, <a href="https://doc.rust-lang.org/std/sync/atomic/struct.AtomicUsize.html#method.fetch_min">fetch_min</a>, <a href="https://doc.rust-lang.org/std/sync/atomic/struct.AtomicPtr.html#method.fetch_update">fetch_update</a>, and <a href="https://github.com/rust-lang/rust/pull/98383">stronger CAS failure ordering</a> available on Rust 1.34+.</li>
<li>Provide workaround for bugs in the standard library’s atomic-related APIs, such as <a href="https://github.com/rust-lang/rust/issues/100650">rust-lang/rust#100650</a>, <code>fence</code>/<code>compiler_fence</code> on MSP430 that cause LLVM error, etc.</li>
</ul>
<h3 id="usage"><a href="#usage">Usage</a></h3>
<p>Add this to your <code>Cargo.toml</code>:</p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
portable-atomic = &quot;0.3&quot;
</code></pre></div>
<p>The default features are mainly for users who use atomics larger than the pointer width.
If you don’t need them, disabling the default features may reduce code size and compile time slightly.</p>
<div class="example-wrap"><pre class="language-toml"><code>[dependencies]
portable-atomic = { version = &quot;0.3&quot;, default-features = false }
</code></pre></div>
<p><em>Compiler support: requires rustc 1.34+</em></p>
<h3 id="128-bit-atomics-support"><a href="#128-bit-atomics-support">128-bit atomics support</a></h3>
<p>Native 128-bit atomic operations are available on x86_64 (Rust 1.59+), aarch64 (Rust 1.59+), powerpc64 (le or pwr8+, nightly only), and s390x (nightly only), otherwise the fallback implementation is used.</p>
<p>On x86_64, even if <code>cmpxchg16b</code> is not available at compile time (note: <code>cmpxchg16b</code> target feature is enabled by default only on macOS), run-time detection checks whether <code>cmpxchg16b</code> is available. If <code>cmpxchg16b</code> is not available at either compile-time or run-time detection, the fallback implementation is used. See also <a href="#optional-cfg-no-outline-atomics"><code>portable_atomic_no_outline_atomics</code></a> cfg.</p>
<p>They are usually implemented using inline assembly, and when using Miri or ThreadSanitizer that do not support inline assembly, core intrinsics are used instead of inline assembly if possible.</p>
<p>See <a href="https://github.com/taiki-e/portable-atomic/issues/10#issuecomment-1159368067">this list</a> for details.</p>
<h3 id="optional-features"><a href="#optional-features">Optional features</a></h3>
<ul>
<li>
<p><strong><code>fallback</code></strong> <em>(enabled by default)</em><br>
Enable fallback implementations.</p>
<p>Disabling this allows only atomic types for which the platform natively supports atomic operations.</p>
</li>
<li>
<p><a name="optional-features-float"></a><strong><code>float</code></strong><br>
Provide <code>AtomicF{32,64}</code>.
Note that most of <code>fetch_*</code> operations of atomic floats are implemented using CAS loops, which can be slower than equivalent operations of atomic integers.</p>
</li>
</ul>
<!-- TODO
- **`generic`**<br>
  Provides generic `Atomic<T>` type.
-->
<ul>
<li>
<p><strong><code>std</code></strong><br>
Use <code>std</code>.</p>
</li>
<li>
<p><strong><code>serde</code></strong><br>
Implement <code>serde::{Serialize,Deserialize}</code> for atomic types.</p>
<p>Note:</p>
<ul>
<li>The MSRV when this feature enables depends on the MSRV of <a href="https://github.com/serde-rs/serde">serde</a>.</li>
</ul>
</li>
</ul>
<h3 id="optional-cfg"><a href="#optional-cfg">Optional cfg</a></h3>
<ul>
<li>
<p><strong><code>--cfg portable_atomic_unsafe_assume_single_core</code></strong><br>
Assume that the target is single-core.
When this cfg is enabled, this crate provides atomic CAS for targets where atomic CAS is not available in the standard library by disabling interrupts.</p>
<p>This cfg is <code>unsafe</code>, and note the following safety requirements:</p>
<ul>
<li>
<p>Enabling this cfg for multi-core systems is always <strong>unsound</strong>.</p>
</li>
<li>
<p>This uses privileged instructions to disable interrupts, so it usually doesn’t work on unprivileged mode.
Enabling this cfg in an environment where privileged instructions are not available, or if the instructions used are not sufficient to disable interrupts in the system, it is also usually considered <strong>unsound</strong>, although the details are system-dependent.</p>
<p>The following are known cases:</p>
<ul>
<li>On pre-v6 ARM, this disables only IRQs by default. For many systems (e.g., GBA) this is enough. If the system need to disable both IRQs and FIQs, you need to pass the <code>--cfg portable_atomic_disable_fiq</code> together.</li>
<li>On RISC-V without A-extension, this generates code for machine-mode (M-mode) by default. If you pass the <code>--cfg portable_atomic_s_mode</code> together, this generates code for supervisor-mode (S-mode). In particular, <code>qemu-system-riscv*</code> uses <a href="https://github.com/riscv-software-src/opensbi">OpenSBI</a> as the default firmware.</li>
</ul>
<p>See also <a href="https://github.com/taiki-e/portable-atomic/blob/HEAD/src/imp/interrupt/README.md">the <code>interrupt</code> module’s readme</a>.</p>
</li>
</ul>
<p>This is intentionally not an optional feature. (If this is an optional feature, dependencies can implicitly enable the feature, resulting in the use of unsound code without the end-user being aware of it.)</p>
<p>ARMv6-M (thumbv6m), pre-v6 ARM (e.g., thumbv4t, thumbv5te), RISC-V without A-extension are currently supported. See <a href="https://github.com/taiki-e/portable-atomic/issues/33">#33</a> for support of multi-core systems.</p>
<p>Since all MSP430 and AVR are single-core, we always provide atomic CAS for them without this cfg.</p>
<p>Enabling this cfg for targets that have atomic CAS will result in a compile error.</p>
<p>The cfg interface is kept between versions, so it is designed to prevent downstream builds from breaking when upgrade to semver-incompatible version unless the portable-atomic types are exposed in the library’s API.</p>
<p>Feel free to submit an issue if your target is not supported yet.</p>
</li>
<li>
<p><a name="optional-cfg-no-outline-atomics"></a><strong><code>--cfg portable_atomic_no_outline_atomics</code></strong><br>
Disable dynamic dispatching by run-time CPU feature detection.</p>
<p>If dynamic dispatching by run-time CPU feature detection is enabled, it allows maintaining support for older CPUs while using features that are not supported on older CPUs, such as CMPXCHG16B (x86_64) and FEAT_LSE (aarch64).</p>
<p>Note:</p>
<ul>
<li>Dynamic detection is currently only enabled in Rust 1.61+ for aarch64, in 1.59+ (AVX) or nightly (CMPXCHG16B) for x86_64, and in nightly for other platforms, otherwise it works the same as when this cfg is set.</li>
<li>If the required target features are enabled at compile-time, the atomic operations are inlined.</li>
<li>This is compatible with no-std (as with all features except <code>std</code>).</li>
<li>Some aarch64 targets enable LLVM’s <code>outline-atomics</code> target feature by default, so if you set this cfg, you may want to disable that as well.</li>
</ul>
<p>See also <a href="https://github.com/taiki-e/portable-atomic/issues/10#issuecomment-1159368067">this list</a>.</p>
</li>
</ul>
<h3 id="related-projects"><a href="#related-projects">Related Projects</a></h3>
<ul>
<li><a href="https://github.com/taiki-e/atomic-maybe-uninit">atomic-maybe-uninit</a>: Atomic operations on potentially uninitialized integers.</li>
<li><a href="https://github.com/taiki-e/atomic-memcpy">atomic-memcpy</a>: Byte-wise atomic memcpy.</li>
</ul>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><div class="item-table"><div class="item-row"><div class="item-left import-item" id="reexport.Ordering"><code>pub use core::sync::atomic::<a class="enum" href="https://doc.rust-lang.org/1.68.2/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.compiler_fence"><code>pub use core::sync::atomic::<a class="fn" href="https://doc.rust-lang.org/1.68.2/core/sync/atomic/fn.compiler_fence.html" title="fn core::sync::atomic::compiler_fence">compiler_fence</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.fence"><code>pub use core::sync::atomic::<a class="fn" href="https://doc.rust-lang.org/1.68.2/core/sync/atomic/fn.fence.html" title="fn core::sync::atomic::fence">fence</a>;</code></div></div></div><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="hint/index.html" title="portable_atomic::hint mod">hint</a></div><div class="item-right docblock-short">Re-export of the <a href="https://doc.rust-lang.org/1.68.2/core/hint/index.html" title="core::hint"><code>core::hint</code></a> module.</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicBool.html" title="portable_atomic::AtomicBool struct">AtomicBool</a></div><div class="item-right docblock-short">A boolean type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicI8.html" title="portable_atomic::AtomicI8 struct">AtomicI8</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicI16.html" title="portable_atomic::AtomicI16 struct">AtomicI16</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicI32.html" title="portable_atomic::AtomicI32 struct">AtomicI32</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicI64.html" title="portable_atomic::AtomicI64 struct">AtomicI64</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicI128.html" title="portable_atomic::AtomicI128 struct">AtomicI128</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicIsize.html" title="portable_atomic::AtomicIsize struct">AtomicIsize</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicPtr.html" title="portable_atomic::AtomicPtr struct">AtomicPtr</a></div><div class="item-right docblock-short">A raw pointer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicU8.html" title="portable_atomic::AtomicU8 struct">AtomicU8</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicU16.html" title="portable_atomic::AtomicU16 struct">AtomicU16</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicU32.html" title="portable_atomic::AtomicU32 struct">AtomicU32</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicU64.html" title="portable_atomic::AtomicU64 struct">AtomicU64</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicU128.html" title="portable_atomic::AtomicU128 struct">AtomicU128</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AtomicUsize.html" title="portable_atomic::AtomicUsize struct">AtomicUsize</a></div><div class="item-right docblock-short">An integer type which can be safely shared between threads.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="portable_atomic" data-themes="" data-resource-suffix="" data-rustdoc-version="1.68.2 (9eb3afe9e 2023-03-27)" data-search-js="search-98d53477a794af0b.js" data-settings-js="settings-c3c521c753752a1a.js" data-settings-css="settings-08ddfdda51b8ee2e.css" ></div></body></html>